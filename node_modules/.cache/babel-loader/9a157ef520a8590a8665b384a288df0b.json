{"ast":null,"code":"import _classCallCheck from \"/home/russ/Documents/spotify/spotify-react-demo/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/home/russ/Documents/spotify/spotify-react-demo/node_modules/@babel/runtime/helpers/esm/createClass\";\n\nfunction _createForOfIteratorHelper(o, allowArrayLike) { var it; if (typeof Symbol === \"undefined\" || o[Symbol.iterator] == null) { if (Array.isArray(o) || (it = _unsupportedIterableToArray(o)) || allowArrayLike && o && typeof o.length === \"number\") { if (it) o = it; var i = 0; var F = function F() {}; return { s: F, n: function n() { if (i >= o.length) return { done: true }; return { done: false, value: o[i++] }; }, e: function e(_e) { throw _e; }, f: F }; } throw new TypeError(\"Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\"); } var normalCompletion = true, didErr = false, err; return { s: function s() { it = o[Symbol.iterator](); }, n: function n() { var step = it.next(); normalCompletion = step.done; return step; }, e: function e(_e2) { didErr = true; err = _e2; }, f: function f() { try { if (!normalCompletion && it.return != null) it.return(); } finally { if (didErr) throw err; } } }; }\n\nfunction _unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === \"string\") return _arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === \"Object\" && o.constructor) n = o.constructor.name; if (n === \"Map\" || n === \"Set\") return Array.from(o); if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen); }\n\nfunction _arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) { arr2[i] = arr[i]; } return arr2; }\n\nexport var ScriptCache = /*#__PURE__*/function () {\n  function ScriptCache(scripts, onSuccess) {\n    _classCallCheck(this, ScriptCache);\n\n    this.loaded = [];\n    this.failed = [];\n    this.pending = [];\n    this.callbacks = {};\n    this.onSuccess = onSuccess;\n    this.load(scripts);\n  }\n\n  _createClass(ScriptCache, [{\n    key: \"load\",\n    value: function load(scripts) {\n      var _iterator = _createForOfIteratorHelper(scripts),\n          _step;\n\n      try {\n        for (_iterator.s(); !(_step = _iterator.n()).done;) {\n          var script = _step.value;\n          this.loadSrc(script.name);\n\n          if (typeof script.callback !== \"undefined\") {\n            this.callbacks[script.name] = script.callback;\n          }\n        }\n      } catch (err) {\n        _iterator.e(err);\n      } finally {\n        _iterator.f();\n      }\n    }\n  }, {\n    key: \"loadSrc\",\n    value: function loadSrc(src) {\n      var _this = this;\n\n      if (this.loaded.indexOf(src) >= 0) {\n        return Promise.resolve(src);\n      }\n\n      this.pending.push(src);\n      return this.scriptTag(src).then(function () {\n        if (_this.callbacks.hasOwnProperty(src)) {\n          console.log(_this);\n\n          _this.callbacks[src](); // run a callback for this script if it exists\n\n        }\n\n        if (_this.pending.length === 0 && _this.onSuccess) {\n          _this.onSuccess();\n        }\n      }).catch(function () {\n        console.log(\"Loading \" + src + \" rejected\");\n      });\n    }\n  }, {\n    key: \"scriptTag\",\n    value: function scriptTag(src, cb) {\n      var _this2 = this;\n\n      return new Promise(function (resolve, reject) {\n        var resolved = false;\n        var errored = false;\n        var body = document.getElementsByTagName('body')[0];\n        var tag = document.createElement('script');\n        tag.type = 'text/javascript';\n        tag.async = false; // Load in order\n\n        tag.onreadystatechange = function () {\n          if (resolved) {\n            return handleLoad();\n          }\n\n          if (errored) {\n            return handleReject();\n          }\n\n          var state = tag.readyState;\n\n          if (state === 'complete') {\n            handleLoad();\n          } else if (state === 'error') {\n            handleReject();\n          }\n        };\n\n        var handleLoad = function handleLoad(evt) {\n          resolved = true;\n\n          _this2.pending.splice(_this2.pending.indexOf(src), 1);\n\n          _this2.loaded.push(src);\n\n          resolve(src);\n        };\n\n        var handleReject = function handleReject(evt) {\n          errored = true;\n\n          _this2.pending.splice(_this2.pending.indexOf(src), 1);\n\n          _this2.failed.push(src);\n\n          reject(src);\n        };\n\n        tag.addEventListener('load', handleLoad);\n        tag.addEventListener('error', handleReject);\n        tag.src = src;\n        body.appendChild(tag);\n        return tag;\n      });\n    }\n  }]);\n\n  return ScriptCache;\n}();","map":{"version":3,"sources":["/home/russ/Documents/spotify/spotify-react-demo/src/ScriptCache.js"],"names":["ScriptCache","scripts","onSuccess","loaded","failed","pending","callbacks","load","script","loadSrc","name","callback","src","indexOf","Promise","resolve","push","scriptTag","then","hasOwnProperty","console","log","length","catch","cb","reject","resolved","errored","body","document","getElementsByTagName","tag","createElement","type","async","onreadystatechange","handleLoad","handleReject","state","readyState","evt","splice","addEventListener","appendChild"],"mappings":";;;;;;;;;AAAA,WAAaA,WAAb;AAEI,uBAAYC,OAAZ,EAAqBC,SAArB,EAAgC;AAAA;;AAC5B,SAAKC,MAAL,GAAc,EAAd;AACA,SAAKC,MAAL,GAAc,EAAd;AACA,SAAKC,OAAL,GAAe,EAAf;AACA,SAAKC,SAAL,GAAiB,EAAjB;AACA,SAAKJ,SAAL,GAAiBA,SAAjB;AACA,SAAKK,IAAL,CAAUN,OAAV;AACH;;AATL;AAAA;AAAA,yBAWSA,OAXT,EAWkB;AAAA,iDACWA,OADX;AAAA;;AAAA;AACV,4DAA8B;AAAA,cAAnBO,MAAmB;AAC1B,eAAKC,OAAL,CAAaD,MAAM,CAACE,IAApB;;AACA,cAAI,OAAOF,MAAM,CAACG,QAAd,KAA2B,WAA/B,EAA4C;AACxC,iBAAKL,SAAL,CAAeE,MAAM,CAACE,IAAtB,IAA8BF,MAAM,CAACG,QAArC;AACH;AACJ;AANS;AAAA;AAAA;AAAA;AAAA;AAOb;AAlBL;AAAA;AAAA,4BAoBYC,GApBZ,EAoBiB;AAAA;;AACT,UAAI,KAAKT,MAAL,CAAYU,OAAZ,CAAoBD,GAApB,KAA4B,CAAhC,EAAmC;AAC/B,eAAOE,OAAO,CAACC,OAAR,CAAgBH,GAAhB,CAAP;AACH;;AAED,WAAKP,OAAL,CAAaW,IAAb,CAAkBJ,GAAlB;AAEA,aAAO,KAAKK,SAAL,CAAeL,GAAf,EACFM,IADE,CACG,YAAM;AACR,YAAI,KAAI,CAACZ,SAAL,CAAea,cAAf,CAA8BP,GAA9B,CAAJ,EAAwC;AACpCQ,UAAAA,OAAO,CAACC,GAAR,CAAY,KAAZ;;AACA,UAAA,KAAI,CAACf,SAAL,CAAeM,GAAf,IAFoC,CAEb;;AAC1B;;AACD,YAAI,KAAI,CAACP,OAAL,CAAaiB,MAAb,KAAwB,CAAxB,IAA6B,KAAI,CAACpB,SAAtC,EAAiD;AAC7C,UAAA,KAAI,CAACA,SAAL;AACH;AACJ,OATE,EAUFqB,KAVE,CAUI,YAAM;AACTH,QAAAA,OAAO,CAACC,GAAR,CAAY,aAAaT,GAAb,GAAmB,WAA/B;AACH,OAZE,CAAP;AAaH;AAxCL;AAAA;AAAA,8BA2CcA,GA3Cd,EA2CmBY,EA3CnB,EA2CuB;AAAA;;AACf,aAAO,IAAIV,OAAJ,CAAY,UAACC,OAAD,EAAUU,MAAV,EAAqB;AACpC,YAAIC,QAAQ,GAAG,KAAf;AACA,YAAIC,OAAO,GAAG,KAAd;AACA,YAAIC,IAAI,GAAGC,QAAQ,CAACC,oBAAT,CAA8B,MAA9B,EAAsC,CAAtC,CAAX;AACA,YAAIC,GAAG,GAAGF,QAAQ,CAACG,aAAT,CAAuB,QAAvB,CAAV;AAEAD,QAAAA,GAAG,CAACE,IAAJ,GAAW,iBAAX;AACAF,QAAAA,GAAG,CAACG,KAAJ,GAAY,KAAZ,CAPoC,CAOjB;;AAEnBH,QAAAA,GAAG,CAACI,kBAAJ,GAAyB,YAAY;AACjC,cAAIT,QAAJ,EAAc;AACV,mBAAOU,UAAU,EAAjB;AACH;;AACD,cAAIT,OAAJ,EAAa;AACT,mBAAOU,YAAY,EAAnB;AACH;;AACD,cAAMC,KAAK,GAAGP,GAAG,CAACQ,UAAlB;;AACA,cAAID,KAAK,KAAK,UAAd,EAA0B;AACtBF,YAAAA,UAAU;AACb,WAFD,MAEO,IAAIE,KAAK,KAAK,OAAd,EAAuB;AAC1BD,YAAAA,YAAY;AACf;AACJ,SAbD;;AAeA,YAAMD,UAAU,GAAG,SAAbA,UAAa,CAACI,GAAD,EAAS;AACxBd,UAAAA,QAAQ,GAAG,IAAX;;AACA,UAAA,MAAI,CAACrB,OAAL,CAAaoC,MAAb,CAAoB,MAAI,CAACpC,OAAL,CAAaQ,OAAb,CAAqBD,GAArB,CAApB,EAA+C,CAA/C;;AACA,UAAA,MAAI,CAACT,MAAL,CAAYa,IAAZ,CAAiBJ,GAAjB;;AACAG,UAAAA,OAAO,CAACH,GAAD,CAAP;AACH,SALD;;AAMA,YAAMyB,YAAY,GAAG,SAAfA,YAAe,CAACG,GAAD,EAAS;AAC1Bb,UAAAA,OAAO,GAAG,IAAV;;AACA,UAAA,MAAI,CAACtB,OAAL,CAAaoC,MAAb,CAAoB,MAAI,CAACpC,OAAL,CAAaQ,OAAb,CAAqBD,GAArB,CAApB,EAA+C,CAA/C;;AACA,UAAA,MAAI,CAACR,MAAL,CAAYY,IAAZ,CAAiBJ,GAAjB;;AACAa,UAAAA,MAAM,CAACb,GAAD,CAAN;AACH,SALD;;AAOAmB,QAAAA,GAAG,CAACW,gBAAJ,CAAqB,MAArB,EAA6BN,UAA7B;AACAL,QAAAA,GAAG,CAACW,gBAAJ,CAAqB,OAArB,EAA8BL,YAA9B;AAEAN,QAAAA,GAAG,CAACnB,GAAJ,GAAUA,GAAV;AACAgB,QAAAA,IAAI,CAACe,WAAL,CAAiBZ,GAAjB;AACA,eAAOA,GAAP;AACH,OA3CM,CAAP;AA4CH;AAxFL;;AAAA;AAAA","sourcesContent":["export class ScriptCache {\n\n    constructor(scripts, onSuccess) {\n        this.loaded = [];\n        this.failed = [];\n        this.pending = [];\n        this.callbacks = {};\n        this.onSuccess = onSuccess;\n        this.load(scripts)\n    }\n\n    load(scripts) {\n        for (const script of scripts) {\n            this.loadSrc(script.name);\n            if (typeof script.callback !== \"undefined\") {\n                this.callbacks[script.name] = script.callback;\n            }\n        }\n    }\n\n    loadSrc(src) {\n        if (this.loaded.indexOf(src) >= 0) {\n            return Promise.resolve(src);\n        }\n\n        this.pending.push(src);\n\n        return this.scriptTag(src)\n            .then(() => {\n                if (this.callbacks.hasOwnProperty(src)) {\n                    console.log(this);\n                    this.callbacks[src](); // run a callback for this script if it exists\n                }\n                if (this.pending.length === 0 && this.onSuccess) {\n                    this.onSuccess();\n                }\n            })\n            .catch(() => {\n                console.log(\"Loading \" + src + \" rejected\");\n            })\n    }\n\n\n    scriptTag(src, cb) {\n        return new Promise((resolve, reject) => {\n            let resolved = false;\n            let errored = false;\n            let body = document.getElementsByTagName('body')[0];\n            let tag = document.createElement('script');\n\n            tag.type = 'text/javascript';\n            tag.async = false; // Load in order\n\n            tag.onreadystatechange = function () {\n                if (resolved) {\n                    return handleLoad();\n                }\n                if (errored) {\n                    return handleReject();\n                }\n                const state = tag.readyState;\n                if (state === 'complete') {\n                    handleLoad()\n                } else if (state === 'error') {\n                    handleReject()\n                }\n            };\n\n            const handleLoad = (evt) => {\n                resolved = true;\n                this.pending.splice(this.pending.indexOf(src), 1);\n                this.loaded.push(src);\n                resolve(src);\n            };\n            const handleReject = (evt) => {\n                errored = true;\n                this.pending.splice(this.pending.indexOf(src), 1);\n                this.failed.push(src);\n                reject(src)\n            };\n\n            tag.addEventListener('load', handleLoad);\n            tag.addEventListener('error', handleReject);\n\n            tag.src = src;\n            body.appendChild(tag);\n            return tag;\n        });\n    }\n}"]},"metadata":{},"sourceType":"module"}